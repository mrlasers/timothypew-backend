name: deploy-backend
run-name: ${{ github.actor }} is deploying timothypew deploy-backend
on: [push]
jobs:
  build:
    runs-on: self-hosted
    environment: production
    steps:
      - uses: actions/checkout@v3
      - run: mkdir -p ~/timothypew-backend
      - run: rm -rf ~/timothypew-backend/*
      - run: cp -r * ~/timothypew-backend
      - run: cd ~/timothypew-backend
      - run: yarn install
      - run: echo OPEN_WEATHER_MAPS_KEY=${{ secrets.OPEN_WEATHER_MAPS_KEY }} > .env
      - run: pwd()
      - run: pm2 startOrReload ecosystem.config.js
